<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buckshot Roulette</title>
<style>
body {
  margin: 0;
  background: #000;
  color: #eee;
  font-family: system-ui, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.game {
  background: #111;
  padding: 1.5rem;
  width: 520px;
  border-radius: 14px;
  box-shadow: 0 0 60px rgba(0,0,0,.9);
}
h1 { text-align: center; margin-bottom: .4rem; }
.row { display: flex; gap: .4rem; flex-wrap: wrap; }
button {
  background: #8b1d1d;
  border: none;
  color: white;
  padding: .5rem .8rem;
  border-radius: 6px;
  cursor: pointer;
}
button.secondary { background: #333; }
button:disabled { opacity: .4; cursor: not-allowed; }
.status, .dealer { min-height: 2em; color: #aaa; }
.inventory {
  display: grid;
  grid-template-columns: repeat(4,1fr);
  gap: .4rem;
}
.slot {
  background: #1c1c1c;
  border: 1px solid #333;
  height: 42px;
  font-size: .7rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.slot.empty { color: #444; cursor: default; }
.hp { font-size: .85rem; margin-bottom: .4rem; }
</style>
</head>
<body>

<div class="game">
  <h1>Buckshot Roulette</h1>

  <div class="hp" id="hp"></div>
  <div class="dealer" id="dealer"></div>

  <div class="row">
    <button onclick="playerFire('dealer')">Fire at Dealer</button>
    <button onclick="playerFire('player')">Fire at Yourself</button>
    <button class="secondary" onclick="reload()">Reload</button>
  </div>

  <div class="status" id="status">â€”</div>

  <h3>Your Inventory</h3>
  <div class="inventory" id="playerInv"></div>

  <h3>Dealer Inventory</h3>
  <div class="inventory" id="dealerInv"></div>
</div>

<script>
/* ===== STATE ===== */
let shells=[];
let playerHP=2, dealerHP=2;
let sawed=false;
let playerTurn=true;
let stealMode=false;

let cuffed={player:false,dealer:false};

let playerInv=Array(8).fill(null);
let dealerInv=Array(8).fill(null);

/* ===== ITEMS ===== */
const ITEMS={
  Beer:()=>ejectShell(),
  Saw:()=>{sawed=true;log("Saw armed.");endPlayerTurn();},
  Magnifier:()=>peek(0),
  Cigarettes:()=>heal("player"),
  Handcuffs:()=>{cuffed.dealer=true;log("Dealer cuffed.");endPlayerTurn();},
  Inverter:()=>invert(),
  Adrenaline:()=>startSteal(),
  Pills:()=>pills("player"),
  Phone:()=>peekFuture()
};

/* ===== RESET ===== */
function resetGame(){
  playerHP=2; dealerHP=2;
  shells=[];
  playerInv.fill(null);
  dealerInv.fill(null);
  sawed=false;
  cuffed={player:false,dealer:false};
  playerTurn=true;
  updateUI("Game reset.");
}

/* ===== RELOAD ===== */
function reload(){
  shells=[]; sawed=false;
  cuffed={player:false,dealer:false};

  const total=r(2,8);
  const live=r(1,total-1);
  const blank=total-live;

  shells.push(...Array(live).fill("LIVE"));
  shells.push(...Array(blank).fill("BLANK"));
  shuffle(shells);

  grantItems(playerInv);
  grantItems(dealerInv);

  log(`Dealer: ${live} live, ${blank} blank.`);
}

/* ===== FIRING ===== */
function playerFire(target){
  if(!playerTurn||stealMode) return;
  fire(target);
  endPlayerTurn();
}

function fire(target){
  if(!shells.length) return log("Empty chamber.");

  const shell=shells.shift();
  if(shell==="LIVE"){
    const dmg=sawed?2:1;
    target==="player"?playerHP-=dmg:dealerHP-=dmg;
    sawed=false;
    log(`ðŸ’¥ LIVE (${dmg})`);
  } else log("clickâ€¦ BLANK");

  checkDeath();
}

/* ===== DEALER AI ===== */
function dealerTurn(){
  if(cuffed.dealer){
    cuffed.dealer=false;
    log("Dealer skips turn.");
    playerTurn=true;
    return;
  }

  // Item usage
  if(useDealerItem("Magnifier")) return;
  if(shells[0]==="LIVE" && useDealerItem("Inverter")) return;
  if(shells[0]==="LIVE" && useDealerItem("Beer")) return;
  if(useDealerItem("Saw")) return;

  // Fire decision
  const liveChance = shells.filter(s=>s==="LIVE").length / shells.length;
  const target = liveChance>=0.5 ? "player" : "dealer";
  fire(target);

  playerTurn=true;
}

/* ===== DEALER ITEM USE ===== */
function useDealerItem(name){
  const i=dealerInv.indexOf(name);
  if(i===-1) return false;

  dealerInv[i]=null;
  log(`Dealer uses ${name}.`);
  ITEMS[name==="Cigarettes"?"Cigarettes":name]?.call();
  renderAll();
  setTimeout(()=>playerTurn=true,600);
  return true;
}

/* ===== ITEMS ===== */
function ejectShell(){
  if(shells.length){shells.shift();log("Shell ejected.");}
}
function peek(i){ if(shells[i]) log(`Peek: ${shells[i]}`); }
function invert(){
  if(shells.length){
    shells[0]=shells[0]==="LIVE"?"BLANK":"LIVE";
    log("Shell inverted.");
    endPlayerTurn();
  }
}
function heal(who){
  who==="player"?playerHP++:dealerHP++;
  log("Healed.");
}
function pills(who){
  Math.random()<.5?heal(who):(who==="player"?playerHP--:dealerHP--);
  checkDeath();
  endPlayerTurn();
}
function peekFuture(){
  const i=r(1,Math.min(3,shells.length-1));
  if(shells[i]) log(`Future ${i+1}: ${shells[i]}`);
}

/* ===== ADRENALINE STEAL ===== */
function startSteal(){
  if(!dealerInv.some(Boolean)) return log("Nothing to steal.");
  stealMode=true;
  log("Choose item to steal.");
  renderInv(dealerInv,"dealerInv",true,true);
}
function stealItem(i){
  const item=dealerInv[i];
  dealerInv[i]=null;
  addItem(playerInv,item);
  stealMode=false;
  log(`Stole ${item}.`);
  endPlayerTurn();
}

/* ===== INVENTORY ===== */
function grantItems(inv){
  for(let i=0;i<r(1,4);i++) addItem(inv,randomItem());
}
function addItem(inv,item){
  const i=inv.indexOf(null);
  if(i!==-1) inv[i]=item;
}
function renderInv(inv,id,clickable,steal=false){
  const el=document.getElementById(id);
  el.innerHTML="";
  inv.forEach((it,i)=>{
    const d=document.createElement("div");
    d.className="slot"+(it?"":" empty");
    d.textContent=it||"Empty";
    if(it&&clickable){
      d.onclick=()=>steal?stealItem(i):(ITEMS[it](),inv[i]=null,renderAll());
    }
    el.appendChild(d);
  });
}

/* ===== FLOW ===== */
function endPlayerTurn(){
  playerTurn=false;
  setTimeout(dealerTurn,900);
}
function checkDeath(){
  if(playerHP<=0) log("You died.");
  if(dealerHP<=0) log("Dealer died.");
}
function updateUI(msg){
  document.getElementById("status").textContent=msg;
  document.getElementById("hp").textContent=
    `Player HP: ${playerHP} | Dealer HP: ${dealerHP}`;
  renderAll();
}
function log(t){updateUI(t);}
function renderAll(){
  renderInv(playerInv,"playerInv",true,false);
  renderInv(dealerInv,"dealerInv",false,false);
}

/* ===== UTIL ===== */
function randomItem(){return Object.keys(ITEMS)[r(0,8)]}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}
function r(a,b){return Math.floor(Math.random()*(b-a+1))+a}
</script>

</body>
</html>
